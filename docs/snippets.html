<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Snippets | The Surgical Informatics Cookbook</title>
  <meta name="description" content="All the brilliant bits of code we don’t want to forget." />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Snippets | The Surgical Informatics Cookbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="All the brilliant bits of code we don’t want to forget." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Snippets | The Surgical Informatics Cookbook" />
  
  <meta name="twitter:description" content="All the brilliant bits of code we don’t want to forget." />
  

<meta name="author" content="Surgical Informatics, University of Edinburgh" />


<meta name="date" content="2022-04-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="data-manipulation.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The Surgical Informatics Cookbook</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#how-to-contribute"><i class="fa fa-check"></i><b>1.1</b> How to contribute</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#indexing"><i class="fa fa-check"></i><b>1.2</b> Indexing</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#index"><i class="fa fa-check"></i><b>1.2.1</b> Index</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction.html"><a href="introduction.html#chapter-and-section-references"><i class="fa fa-check"></i><b>1.2.2</b> Chapter and section references</a></li>
<li class="chapter" data-level="1.2.3" data-path="introduction.html"><a href="introduction.html#figure-and-table-references"><i class="fa fa-check"></i><b>1.2.3</b> Figure and table references</a></li>
<li class="chapter" data-level="1.2.4" data-path="introduction.html"><a href="introduction.html#citations"><i class="fa fa-check"></i><b>1.2.4</b> Citations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="snippets.html"><a href="snippets.html"><i class="fa fa-check"></i><b>2</b> Snippets</a>
<ul>
<li class="chapter" data-level="2.1" data-path="snippets.html"><a href="snippets.html#useful-rstudio-functions"><i class="fa fa-check"></i><b>2.1</b> Useful RStudio functions</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="snippets.html"><a href="snippets.html#clean-restart"><i class="fa fa-check"></i><b>2.1.1</b> Clean restart</a></li>
<li class="chapter" data-level="2.1.2" data-path="snippets.html"><a href="snippets.html#remove-duplicated-packages-between-personal-and-system-libraries"><i class="fa fa-check"></i><b>2.1.2</b> Remove duplicated packages between personal and system libraries</a></li>
<li class="chapter" data-level="2.1.3" data-path="snippets.html"><a href="snippets.html#remove-large-file-accidentally-committed-to-git"><i class="fa fa-check"></i><b>2.1.3</b> Remove large file accidentally committed to git</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="snippets.html"><a href="snippets.html#memory-and-efficient-ram-usage"><i class="fa fa-check"></i><b>2.2</b> Memory and efficient RAM usage</a></li>
<li class="chapter" data-level="2.3" data-path="snippets.html"><a href="snippets.html#exporting-tables-that-work-in-both-pdf-and-word"><i class="fa fa-check"></i><b>2.3</b> Exporting tables that work in both PDF and Word</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="snippets.html"><a href="snippets.html#warning-in-kableextra.-please-specify-format-in-kable.-kableextra-can-customize-either-html-or-latex-outputs."><i class="fa fa-check"></i><b>2.3.1</b> Warning in kableExtra. Please specify format in kable. kableExtra can customize either HTML or LaTeX outputs.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="snippets.html"><a href="snippets.html#creating-reproducible-r-examples-to-share-in-the-group-binder-holepunch-and-docker"><i class="fa fa-check"></i><b>2.4</b> Creating Reproducible R Examples to Share in the Group (binder, holepunch and docker)</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="snippets.html"><a href="snippets.html#create-basic-reproducible-examples"><i class="fa fa-check"></i><b>2.4.1</b> Create Basic Reproducible Examples</a></li>
<li class="chapter" data-level="2.4.2" data-path="snippets.html"><a href="snippets.html#holepunch---complex-reproducible-examples"><i class="fa fa-check"></i><b>2.4.2</b> <code>holepunch</code> - Complex Reproducible Examples</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="snippets.html"><a href="snippets.html#working-with-chis"><i class="fa fa-check"></i><b>2.5</b> Working with CHIs</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="snippets.html"><a href="snippets.html#chi_dob---extract-date-of-birth-from-chi"><i class="fa fa-check"></i><b>2.5.1</b> <code>chi_dob()</code> - Extract date of birth from CHI</a></li>
<li class="chapter" data-level="2.5.2" data-path="snippets.html"><a href="snippets.html#chi_gender---extract-gender-from-chi"><i class="fa fa-check"></i><b>2.5.2</b> <code>chi_gender()</code> - Extract gender from CHI</a></li>
<li class="chapter" data-level="2.5.3" data-path="snippets.html"><a href="snippets.html#chi_age---extract-age-from-chi"><i class="fa fa-check"></i><b>2.5.3</b> <code>chi_age()</code> - Extract age from CHI</a></li>
<li class="chapter" data-level="2.5.4" data-path="snippets.html"><a href="snippets.html#chi_valid---logical-test-for-valid-chi"><i class="fa fa-check"></i><b>2.5.4</b> <code>chi_valid()</code> - Logical test for valid CHI</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="snippets.html"><a href="snippets.html#working-with-dates"><i class="fa fa-check"></i><b>2.6</b> Working with dates</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="snippets.html"><a href="snippets.html#difference-between-two-dates"><i class="fa fa-check"></i><b>2.6.1</b> Difference between two dates</a></li>
<li class="chapter" data-level="2.6.2" data-path="snippets.html"><a href="snippets.html#lags"><i class="fa fa-check"></i><b>2.6.2</b> Lags</a></li>
<li class="chapter" data-level="2.6.3" data-path="snippets.html"><a href="snippets.html#pulling-out-change-in-status-data"><i class="fa fa-check"></i><b>2.6.3</b> Pulling out “change in status” data</a></li>
<li class="chapter" data-level="2.6.4" data-path="snippets.html"><a href="snippets.html#guess-the-format-of-dates"><i class="fa fa-check"></i><b>2.6.4</b> Guess the Format of Dates</a></li>
<li class="chapter" data-level="2.6.5" data-path="snippets.html"><a href="snippets.html#isoweek-and-epiweek"><i class="fa fa-check"></i><b>2.6.5</b> Isoweek and epiweek</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="snippets.html"><a href="snippets.html#labelling-tables-and-figures-in-markdown-chunks"><i class="fa fa-check"></i><b>2.7</b> Labelling tables and figures in markdown chunks</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="snippets.html"><a href="snippets.html#plots"><i class="fa fa-check"></i><b>2.7.1</b> Plots</a></li>
<li class="chapter" data-level="2.7.2" data-path="snippets.html"><a href="snippets.html#tables"><i class="fa fa-check"></i><b>2.7.2</b> Tables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-manipulation.html"><a href="data-manipulation.html"><i class="fa fa-check"></i><b>3</b> Data manipulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-manipulation.html"><a href="data-manipulation.html#collapse-multiple-no-and-yes-options"><i class="fa fa-check"></i><b>3.1</b> Collapse multiple “no” and “yes” options</a></li>
<li class="chapter" data-level="3.2" data-path="data-manipulation.html"><a href="data-manipulation.html#filter-na-dropping-rows-where-all-specified-variables-are-na"><i class="fa fa-check"></i><b>3.2</b> Filter NA: Dropping rows where all specified variables are NA</a></li>
<li class="chapter" data-level="3.3" data-path="data-manipulation.html"><a href="data-manipulation.html#vectorising-rowwise-procedures"><i class="fa fa-check"></i><b>3.3</b> Vectorising rowwise procedures</a></li>
<li class="chapter" data-level="3.4" data-path="data-manipulation.html"><a href="data-manipulation.html#multiple-imputation-and-ipw-for-missing-data"><i class="fa fa-check"></i><b>3.4</b> Multiple imputation and IPW for missing data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="data-manipulation.html"><a href="data-manipulation.html#data"><i class="fa fa-check"></i><b>3.4.1</b> Data</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-manipulation.html"><a href="data-manipulation.html#multiple-imputation"><i class="fa fa-check"></i><b>3.4.2</b> Multiple imputation</a></li>
<li class="chapter" data-level="3.4.3" data-path="data-manipulation.html"><a href="data-manipulation.html#ipw"><i class="fa fa-check"></i><b>3.4.3</b> IPW</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>4</b> Machine learning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="machine-learning.html"><a href="machine-learning.html#deep-learning"><i class="fa fa-check"></i><b>4.1</b> Deep learning</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="machine-learning.html"><a href="machine-learning.html#pulling-images-from-redcap-directly-to-argodeep"><i class="fa fa-check"></i><b>4.1.1</b> Pulling images from REDCap directly to argodeep</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html"><i class="fa fa-check"></i><b>5</b> Data Transfer and Eddie</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#uploading-and-downloading-data-the-easy-way"><i class="fa fa-check"></i><b>5.1</b> Uploading and Downloading Data the Easy Way</a></li>
<li class="chapter" data-level="5.2" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#alternative-methods-when-the-easy-way-wont-work"><i class="fa fa-check"></i><b>5.2</b> Alternative Methods when the Easy Way won’t work</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#what-is-eddie"><i class="fa fa-check"></i><b>5.2.1</b> What is Eddie?</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#using-the-command-line"><i class="fa fa-check"></i><b>5.3</b> Using the Command Line</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#downloads-and-setup---eddie-example"><i class="fa fa-check"></i><b>5.3.1</b> Downloads and Setup - Eddie Example</a></li>
<li class="chapter" data-level="5.3.2" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#copy-and-paste-with-putty"><i class="fa fa-check"></i><b>5.3.2</b> Copy and Paste with PuTTY</a></li>
<li class="chapter" data-level="5.3.3" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#closing-a-session-in-putty"><i class="fa fa-check"></i><b>5.3.3</b> Closing a Session in PuTTY</a></li>
<li class="chapter" data-level="5.3.4" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#eddie-file-structure"><i class="fa fa-check"></i><b>5.3.4</b> Eddie File Structure</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#copying-data-from-eddie-into-rstudio-server"><i class="fa fa-check"></i><b>5.4</b> Copying Data from Eddie into RStudio server</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#method-1-using-putty-or-another-terminalshell-connected-to-eddie"><i class="fa fa-check"></i><b>5.4.1</b> Method 1: Using PuTTY (or another terminal/shell connected to Eddie)</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#method-2-using-the-rstudio-server-terminal"><i class="fa fa-check"></i><b>5.4.2</b> Method 2: Using the RStudio Server Terminal</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#the-surgical-informatics-group-folder-on-eddie"><i class="fa fa-check"></i><b>5.5</b> The Surgical Informatics Group Folder (On Eddie)</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#the-scratch-space"><i class="fa fa-check"></i><b>5.5.1</b> The Scratch Space</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#other-spaces"><i class="fa fa-check"></i><b>5.5.2</b> Other Spaces</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#running-eddie-from-rstudio-server"><i class="fa fa-check"></i><b>5.5.3</b> Running Eddie from RStudio Server</a></li>
<li class="chapter" data-level="5.5.4" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#modules-applications-in-eddie"><i class="fa fa-check"></i><b>5.5.4</b> Modules (Applications) in Eddie</a></li>
<li class="chapter" data-level="5.5.5" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#working-with-r-in-eddie"><i class="fa fa-check"></i><b>5.5.5</b> Working with R in Eddie</a></li>
<li class="chapter" data-level="5.5.6" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#specific-r-package-versions"><i class="fa fa-check"></i><b>5.5.6</b> Specific R Package Versions</a></li>
<li class="chapter" data-level="5.5.7" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#general-eddie-etiquette"><i class="fa fa-check"></i><b>5.5.7</b> General Eddie Etiquette</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#unix-tutorials"><i class="fa fa-check"></i><b>5.6</b> Unix Tutorials</a></li>
<li class="chapter" data-level="5.7" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#additional-resources"><i class="fa fa-check"></i><b>5.7</b> Additional Resources</a></li>
<li class="chapter" data-level="5.8" data-path="data-transfer-and-eddie.html"><a href="data-transfer-and-eddie.html#using-rstudio-directly-in-eddie"><i class="fa fa-check"></i><b>5.8</b> Using RStudio directly in Eddie</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i><b>6</b> Plotting</a>
<ul>
<li class="chapter" data-level="6.1" data-path="plotting.html"><a href="plotting.html#gghighlight-example"><i class="fa fa-check"></i><b>6.1</b> GGHighlight Example</a></li>
<li class="chapter" data-level="6.2" data-path="plotting.html"><a href="plotting.html#coord_flip-factor-orders"><i class="fa fa-check"></i><b>6.2</b> <code>coord_flip()</code> factor orders</a></li>
<li class="chapter" data-level="6.3" data-path="plotting.html"><a href="plotting.html#axis-font-size"><i class="fa fa-check"></i><b>6.3</b> Axis font size</a></li>
<li class="chapter" data-level="6.4" data-path="plotting.html"><a href="plotting.html#shorten-arrows-on-a-dag"><i class="fa fa-check"></i><b>6.4</b> Shorten Arrows on a DAG</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="genomics.html"><a href="genomics.html"><i class="fa fa-check"></i><b>7</b> Genomics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="genomics.html"><a href="genomics.html#single-cell-analysis"><i class="fa fa-check"></i><b>7.1</b> Single Cell Analysis</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="genomics.html"><a href="genomics.html#minimising-the-size-of-a-seurat-object"><i class="fa fa-check"></i><b>7.1.1</b> Minimising the size of a Seurat Object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="programming-in-rlang.html"><a href="programming-in-rlang.html"><i class="fa fa-check"></i><b>8</b> Programming in rlang</a>
<ul>
<li class="chapter" data-level="8.1" data-path="programming-in-rlang.html"><a href="programming-in-rlang.html#rlang"><i class="fa fa-check"></i><b>8.1</b> rlang</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="programming-in-rlang.html"><a href="programming-in-rlang.html#what-is-rlang"><i class="fa fa-check"></i><b>8.1.1</b> What is rlang?</a></li>
<li class="chapter" data-level="8.1.2" data-path="programming-in-rlang.html"><a href="programming-in-rlang.html#dynamic-calling-of-variables-using-dplyr"><i class="fa fa-check"></i><b>8.1.2</b> Dynamic calling of variables using dplyr</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="server-admin.html"><a href="server-admin.html"><i class="fa fa-check"></i><b>9</b> Server admin</a>
<ul>
<li class="chapter" data-level="9.1" data-path="server-admin.html"><a href="server-admin.html#rstudio-argonaut-and-argosafe"><i class="fa fa-check"></i><b>9.1</b> RStudio (argonaut and argosafe)</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="server-admin.html"><a href="server-admin.html#scheduled-script-cron"><i class="fa fa-check"></i><b>9.1.1</b> Scheduled script (CRON)</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="server-admin.html"><a href="server-admin.html#rstudio-connect-argoshare"><i class="fa fa-check"></i><b>9.2</b> RStudio Connect: argoshare</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="server-admin.html"><a href="server-admin.html#delete-user"><i class="fa fa-check"></i><b>9.2.1</b> Delete user</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="server-admin.html"><a href="server-admin.html#shiny-server-opensource-setup---uoe-eleanor"><i class="fa fa-check"></i><b>9.3</b> Shiny server opensource setup - UoE Eleanor</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="server-admin.html"><a href="server-admin.html#setting-up-ubuntu-instance"><i class="fa fa-check"></i><b>9.3.1</b> Setting up Ubuntu Instance</a></li>
<li class="chapter" data-level="9.3.2" data-path="server-admin.html"><a href="server-admin.html#install-nginx"><i class="fa fa-check"></i><b>9.3.2</b> Install Nginx</a></li>
<li class="chapter" data-level="9.3.3" data-path="server-admin.html"><a href="server-admin.html#installing-r"><i class="fa fa-check"></i><b>9.3.3</b> Installing R</a></li>
<li class="chapter" data-level="9.3.4" data-path="server-admin.html"><a href="server-admin.html#installing-shiny-server"><i class="fa fa-check"></i><b>9.3.4</b> Installing Shiny Server</a></li>
<li class="chapter" data-level="9.3.5" data-path="server-admin.html"><a href="server-admin.html#installing-other-linux-packages"><i class="fa fa-check"></i><b>9.3.5</b> Installing other Linux packages</a></li>
<li class="chapter" data-level="9.3.6" data-path="server-admin.html"><a href="server-admin.html#installing-r-packages"><i class="fa fa-check"></i><b>9.3.6</b> Installing R packages</a></li>
<li class="chapter" data-level="9.3.7" data-path="server-admin.html"><a href="server-admin.html#loading-your-app"><i class="fa fa-check"></i><b>9.3.7</b> Loading your app</a></li>
<li class="chapter" data-level="9.3.8" data-path="server-admin.html"><a href="server-admin.html#make-your-app-the-default-index-page"><i class="fa fa-check"></i><b>9.3.8</b> Make your app the default index page</a></li>
<li class="chapter" data-level="9.3.9" data-path="server-admin.html"><a href="server-admin.html#getting-a-user-friendly-domain-name"><i class="fa fa-check"></i><b>9.3.9</b> Getting a user-friendly domain name</a></li>
<li class="chapter" data-level="9.3.10" data-path="server-admin.html"><a href="server-admin.html#appendix-1-password-protecting-your-site"><i class="fa fa-check"></i><b>9.3.10</b> Appendix 1 – Password protecting your site</a></li>
<li class="chapter" data-level="9.3.11" data-path="server-admin.html"><a href="server-admin.html#appendix-2-setting-up-a-swap-file"><i class="fa fa-check"></i><b>9.3.11</b> APPENDIX 2 – Setting up a swap file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="redcap.html"><a href="redcap.html"><i class="fa fa-check"></i><b>10</b> REDCap</a>
<ul>
<li class="chapter" data-level="10.1" data-path="redcap.html"><a href="redcap.html#api-pull"><i class="fa fa-check"></i><b>10.1</b> API pull</a></li>
<li class="chapter" data-level="10.2" data-path="redcap.html"><a href="redcap.html#applying-a-redcap-factoring-script"><i class="fa fa-check"></i><b>10.2</b> Applying a REDCap factoring script</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html"><i class="fa fa-check"></i><b>11</b> Citations with R Markdown</a>
<ul>
<li class="chapter" data-level="11.1" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#zotero-set-up"><i class="fa fa-check"></i><b>11.1</b> Zotero Set-up</a></li>
<li class="chapter" data-level="11.2" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#file-storage-set-up"><i class="fa fa-check"></i><b>11.2</b> File Storage Set-up</a></li>
<li class="chapter" data-level="11.3" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#folder-set-up"><i class="fa fa-check"></i><b>11.3</b> Folder Set-up</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#storing-pdfs"><i class="fa fa-check"></i><b>11.3.1</b> Storing PDFs</a></li>
<li class="chapter" data-level="11.3.2" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#storing-bibliographies"><i class="fa fa-check"></i><b>11.3.2</b> Storing Bibliographies</a></li>
<li class="chapter" data-level="11.3.3" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#subfolder-for-references"><i class="fa fa-check"></i><b>11.3.3</b> Subfolder for References</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#configuring-zotero"><i class="fa fa-check"></i><b>11.4</b> Configuring Zotero</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#zotfile-pdf-preferences"><i class="fa fa-check"></i><b>11.4.1</b> ZotFile PDF Preferences</a></li>
<li class="chapter" data-level="11.4.2" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#general-zotero-settings"><i class="fa fa-check"></i><b>11.4.2</b> General Zotero Settings</a></li>
<li class="chapter" data-level="11.4.3" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#refresh-bibtex-citation-key"><i class="fa fa-check"></i><b>11.4.3</b> Refresh BibTex Citation Key</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#generating-a-.bib-file"><i class="fa fa-check"></i><b>11.5</b> Generating a .bib File</a></li>
<li class="chapter" data-level="11.6" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#linking-dropbox-and-rstudio-server"><i class="fa fa-check"></i><b>11.6</b> Linking DropBox and Rstudio Server</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#token-creation"><i class="fa fa-check"></i><b>11.6.1</b> Token Creation</a></li>
<li class="chapter" data-level="11.6.2" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#dropbox-linkage"><i class="fa fa-check"></i><b>11.6.2</b> DropBox Linkage</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="citations-with-r-markdown.html"><a href="citations-with-r-markdown.html#citing-r-packages"><i class="fa fa-check"></i><b>11.7</b> Citing R Packages</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Surgical Informatics Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="snippets" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Snippets</h1>
<p>Random useful snippets that do not fit anywhere else.</p>
<div id="useful-rstudio-functions" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Useful RStudio functions</h2>
<div id="clean-restart" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Clean restart</h3>
<p>Cleans current environment and restarts R session (no code can run past this). Indicate objects to leave alone by supplying string to <code>leave</code> argument.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="snippets.html#cb3-1" aria-hidden="true" tabindex="-1"></a>clean_restart <span class="ot">=</span> <span class="cf">function</span>(<span class="at">leave =</span> <span class="cn">NULL</span>){</span>
<span id="cb3-2"><a href="snippets.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(<span class="at">envir =</span> .GlobalEnv), leave), <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb3-3"><a href="snippets.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">.rs.restartR</span>())</span>
<span id="cb3-4"><a href="snippets.html#cb3-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="remove-duplicated-packages-between-personal-and-system-libraries" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Remove duplicated packages between personal and system libraries</h3>
<p>This removes any user library packages that are also present in the system library. Use this to minimise loading conflicts. Change <code>tdrake</code> in example to your rstudio username.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="snippets.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="snippets.html#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="snippets.html#cb4-3" aria-hidden="true" tabindex="-1"></a>tdrake_packages <span class="ot">=</span> <span class="fu">installed.packages</span>() <span class="sc">%&gt;%</span> <span class="co">#change &#39;tdrake&#39; to your rstudio username</span></span>
<span id="cb4-4"><a href="snippets.html#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="snippets.html#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LibPath <span class="sc">%&gt;%</span> <span class="fu">str_detect</span>(<span class="st">&quot;tdrake&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="snippets.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Package)</span>
<span id="cb4-7"><a href="snippets.html#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="snippets.html#cb4-8" aria-hidden="true" tabindex="-1"></a>system_packages <span class="ot">=</span> <span class="fu">installed.packages</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-9"><a href="snippets.html#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="snippets.html#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LibPath <span class="sc">%&gt;%</span> <span class="fu">str_detect</span>(<span class="st">&quot;local&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="snippets.html#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Package)</span>
<span id="cb4-12"><a href="snippets.html#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="snippets.html#cb4-13" aria-hidden="true" tabindex="-1"></a>to_remove <span class="ot">=</span> tdrake_packages[tdrake_packages <span class="sc">%in%</span> system_packages]</span>
<span id="cb4-14"><a href="snippets.html#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="snippets.html#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">remove.packages</span>(to_remove)</span>
<span id="cb4-16"><a href="snippets.html#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
</div>
<div id="remove-large-file-accidentally-committed-to-git" class="section level3" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Remove large file accidentally committed to git</h3>
<p><code>git filter-branch -f --index-filter "git rm -rf --cached --ignore-unmatch filename.rda" HEAD</code>.</p>
</div>
</div>
<div id="memory-and-efficient-ram-usage" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Memory and efficient RAM usage</h2>
<ol style="list-style-type: decimal">
<li>Restart R often</li>
<li>Use <code>rm(...)</code> to get rid of big files after using them</li>
<li>Save large objects (and compress with “gz”) that take a while to create but are needed often (<code>write_rds(x, "big_file.rds.gz", compress = "gz)</code>)</li>
<li>Run <code>gc()</code> (garbage collect)</li>
<li>Check memory usage: <code>pryr::mem_used()</code></li>
</ol>
<p>Most importantly if using big files (even if they aren’t loaded in your environment!) do the following:</p>
<ol style="list-style-type: decimal">
<li><code>save.image("temp.rda")</code></li>
<li>Restart R</li>
<li><code>load("temp.rda")</code></li>
<li>Delete “temp.rda” from <code>Files</code> pane</li>
</ol>
</div>
<div id="exporting-tables-that-work-in-both-pdf-and-word" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Exporting tables that work in both PDF and Word</h2>
<p>The <code>kable()</code> function from <code>library(knitr)</code> formats tables for all 3 output formats, but it is a bit limited.
<code>library(kableExtra)</code> is great for table customisations that work in PDF and HTML.
<code>kableExtra</code> functions do not work for Word output, but <code>library(flextable)</code> does work for Word (but not for PDF).</p>
<p>We can define our own table printing function that uses kableExtra or flextable based on output type:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="snippets.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This makes table resize or continue over multiple pages in all output types</span></span>
<span id="cb5-2"><a href="snippets.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># PDF powered by kableExtra, Word by flextable</span></span>
<span id="cb5-3"><a href="snippets.html#cb5-3" aria-hidden="true" tabindex="-1"></a>mytable <span class="ot">=</span> <span class="cf">function</span>(x, <span class="at">caption =</span> <span class="st">&quot;&quot;</span>, <span class="at">longtable =</span> <span class="cn">FALSE</span>, ...){</span>
<span id="cb5-4"><a href="snippets.html#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(kableExtra)</span>
<span id="cb5-5"><a href="snippets.html#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if not latex or html then else is Word</span></span>
<span id="cb5-6"><a href="snippets.html#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (knitr<span class="sc">::</span><span class="fu">is_latex_output</span>() <span class="sc">|</span> knitr<span class="sc">::</span><span class="fu">is_html_output</span>()){</span>
<span id="cb5-7"><a href="snippets.html#cb5-7" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(x, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="st">&quot;r&quot;</span>), </span>
<span id="cb5-8"><a href="snippets.html#cb5-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">booktabs =</span> <span class="cn">TRUE</span>, <span class="at">caption =</span> caption, <span class="at">longtable =</span> longtable,</span>
<span id="cb5-9"><a href="snippets.html#cb5-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">linesep =</span> <span class="st">&quot;&quot;</span>, ...) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="snippets.html#cb5-10" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;scale_down&quot;</span>, <span class="st">&quot;hold_position&quot;</span>))</span>
<span id="cb5-11"><a href="snippets.html#cb5-11" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb5-12"><a href="snippets.html#cb5-12" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">flextable</span>(x) <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="snippets.html#cb5-13" aria-hidden="true" tabindex="-1"></a>      flextable<span class="sc">::</span><span class="fu">autofit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="snippets.html#cb5-14" aria-hidden="true" tabindex="-1"></a>      flextable<span class="sc">::</span><span class="fu">width</span>(<span class="at">j =</span> <span class="dv">1</span>, <span class="at">width =</span> <span class="fl">1.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="snippets.html#cb5-15" aria-hidden="true" tabindex="-1"></a>      flextable<span class="sc">::</span><span class="fu">height</span>(<span class="at">i =</span> <span class="dv">1</span>, <span class="at">height =</span> <span class="fl">0.5</span>, <span class="at">part =</span> <span class="st">&quot;header&quot;</span>)</span>
<span id="cb5-16"><a href="snippets.html#cb5-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-17"><a href="snippets.html#cb5-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-18"><a href="snippets.html#cb5-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-19"><a href="snippets.html#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-20"><a href="snippets.html#cb5-20" aria-hidden="true" tabindex="-1"></a>cars <span class="sc">%&gt;%</span> </span>
<span id="cb5-21"><a href="snippets.html#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-22"><a href="snippets.html#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mytable</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-3">Table 2.1: </span>
</caption>
<thead>
<tr>
<th style="text-align:left;">
speed
</th>
<th style="text-align:left;">
dist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
22
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
10
</td>
</tr>
</tbody>
</table>
<div id="warning-in-kableextra.-please-specify-format-in-kable.-kableextra-can-customize-either-html-or-latex-outputs." class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Warning in kableExtra. Please specify format in kable. kableExtra can customize either HTML or LaTeX outputs.</h3>
<p>This warning goes away when you load <code>library(kableExtra)</code> in your script, instead of just using <code>kableExtra::function()</code>.</p>
<p>What happens when you load <code>library(kableExtra)</code> is that it sets that specifies the format for the R session, so that Warning goes away. It does mean that the <code>render()</code> function may fail since it knits in the same environment you have, rather than a new one like the Knit button does.</p>
</div>
</div>
<div id="creating-reproducible-r-examples-to-share-in-the-group-binder-holepunch-and-docker" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Creating Reproducible R Examples to Share in the Group (binder, holepunch and docker)</h2>
<p>When asking for help with R code having a reproducible example is crucial (some mock data that others can use along with your code to reproduce your error). Often this can be done easily with creation of a small tibble and posting of the code on slack but sometimes it requires more complex data or the error is due to something in the Linux system in which RStudio server is hosted. For example if the <code>cairo</code> package for Linux isn’t installed then plots don’t work. The <code>holepunch</code> package helps to reproduce examples like these (not suitable for projects with confidential data).</p>
<div id="create-basic-reproducible-examples" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Create Basic Reproducible Examples</h3>
<p>The three main parts of the reproducible example (reprex) in Surgical Informatics are 1. packages, 2. small dataset and 3. code. Other things like R version and Linux version can be assumed as we all use one of only a few servers.</p>
<p>If you have a small (and confidential) set of data in a tibble or data frame called <code>my_data</code> and want it to be easily copied run: <code>dput(droplevels(my_data))</code>. This will print out code in the console that can be copy-pasted to reproduce the data frame. Alternatively use the <code>tibble</code> or <code>tribble</code> functions to create it from scratch (this is preferable for simple datasets). Then copy in the packages and finally the code (ideally the least amount possible to generate the error) and share with the group e.g.:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="snippets.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-2"><a href="snippets.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="snippets.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Output generated from dput(droplevels(my_data))</span></span>
<span id="cb6-4"><a href="snippets.html#cb6-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">b =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="at">c =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">12</span>), <span class="at">.Names =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, </span>
<span id="cb6-5"><a href="snippets.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="at">row.names =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="sc">-</span>3L), <span class="at">class =</span> <span class="fu">c</span>(<span class="st">&quot;tbl_df&quot;</span>, <span class="st">&quot;tbl&quot;</span>, </span>
<span id="cb6-6"><a href="snippets.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;data.frame&quot;</span>))</span>
<span id="cb6-7"><a href="snippets.html#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="snippets.html#cb6-8" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="snippets.html#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">newvar =</span> a <span class="sc">/</span>b)</span></code></pre></div>
<pre><code>## Error in `mutate_cols()`:
## ! Problem with `mutate()` column `newvar`.
## ℹ `newvar = a/b`.
## x non-numeric argument to binary operator
## Caused by error in `a / b`:
## ! non-numeric argument to binary operator</code></pre>
</div>
<div id="holepunch---complex-reproducible-examples" class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> <code>holepunch</code> - Complex Reproducible Examples</h3>
<p>From your project with data you are happy to make public make sure you are backed up to <code>git</code> and <code>GitHub</code>. See the relevant chapter on how to do this. Then run the following:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="snippets.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Holepunch testing</span></span>
<span id="cb8-2"><a href="snippets.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="snippets.html#cb8-3" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;karthik/holepunch&quot;</span>)</span>
<span id="cb8-4"><a href="snippets.html#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="snippets.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(holepunch)</span>
<span id="cb8-6"><a href="snippets.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_compendium_description</span>(<span class="at">package =</span> <span class="st">&quot;Title of my project&quot;</span>, </span>
<span id="cb8-7"><a href="snippets.html#cb8-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">description =</span> <span class="st">&quot;Rough description of project or issue&quot;</span>)</span>
<span id="cb8-8"><a href="snippets.html#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="snippets.html#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_dockerfile</span>(<span class="at">maintainer =</span> <span class="st">&quot;SurgicalInformatics&quot;</span>)</span>
<span id="cb8-10"><a href="snippets.html#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="snippets.html#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_badge</span>()</span>
<span id="cb8-12"><a href="snippets.html#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="snippets.html#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">build_binder</span>()</span></code></pre></div>
<p>The file will generate some text to copy into the top of a <code>README.md</code> file. It will look like:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="snippets.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;!--</span> badges<span class="sc">:</span> start <span class="sc">-</span><span class="ot">-&gt;</span></span>
<span id="cb9-2"><a href="snippets.html#cb9-2" aria-hidden="true" tabindex="-1"></a>[<span class="sc">!</span>[Launch Rstudio Binder](http<span class="sc">:</span><span class="er">//</span>mybinder.org<span class="sc">/</span>badge_logo.svg)](https<span class="sc">:</span><span class="er">//</span>mybinder.org<span class="sc">/</span>v2<span class="sc">/</span>gh<span class="sc">/</span>SurgicalInformatics<span class="sc">/</span><span class="er">&lt;</span>project<span class="sc">&gt;</span><span class="er">/</span>master?<span class="at">urlpath=</span>rstudio)</span>
<span id="cb9-3"><a href="snippets.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;!--</span> badges<span class="sc">:</span> end <span class="sc">-</span><span class="ot">-&gt;</span></span></code></pre></div>
<p>Now, whenever somebody clicks on the badge in the <code>README</code> on <code>GitHub</code> they will be taken to an RStudio server instance with all your files (excluding files listed in <code>.gitignore</code>), all the current versions of your package, all the current Linux packages and the current R version. They can then test your code in an near-identical environment to help identify the source of the error, their session will time out after 10 minutes of inactivity or 12 hours since starting and will not save anything so should only be used for bug-testing or quick examples.</p>
<p>As this is a free version of RStudio server there is a limit to what is supported and it shouldn’t be used for computationally-intensive processes.</p>
<p>And, as mentioned: <strong>No confidential data.</strong></p>
</div>
</div>
<div id="working-with-chis" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Working with CHIs</h2>
<p>Here are 4 functions for CHIs that could even be put in a small package.
The Community Health Index (CHI) is a population register, which is used in Scotland for health care purposes.
The CHI number uniquely identifies a person on the index.</p>
<div id="chi_dob---extract-date-of-birth-from-chi" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> <code>chi_dob()</code> - Extract date of birth from CHI</h3>
<p>Note <code>cutoff_2000</code>.
As CHI has only a two digit year, need to decide whether year is 1900s or 2000s.
I don’t think there is a formal way of determining this.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="snippets.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-2"><a href="snippets.html#cb10-2" aria-hidden="true" tabindex="-1"></a>chi <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;1009701234&quot;</span>, <span class="st">&quot;1811431232&quot;</span>, <span class="st">&quot;1304496368&quot;</span>)</span>
<span id="cb10-3"><a href="snippets.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># These CHIs are not real. </span></span>
<span id="cb10-4"><a href="snippets.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The first is invalid, two and three are valid. </span></span>
<span id="cb10-5"><a href="snippets.html#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="snippets.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut-off any thing before that number is considered 2000s</span></span>
<span id="cb10-7"><a href="snippets.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e. at cutoff_2000 = 20, &quot;18&quot; is considered 2018, rather than 1918. </span></span>
<span id="cb10-8"><a href="snippets.html#cb10-8" aria-hidden="true" tabindex="-1"></a>chi_dob <span class="ot">=</span> <span class="cf">function</span>(.data, <span class="at">cutoff_2000 =</span> <span class="dv">20</span>){</span>
<span id="cb10-9"><a href="snippets.html#cb10-9" aria-hidden="true" tabindex="-1"></a>  .data <span class="sc">%&gt;%</span> </span>
<span id="cb10-10"><a href="snippets.html#cb10-10" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;.{6}&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-11"><a href="snippets.html#cb10-11" aria-hidden="true" tabindex="-1"></a>    lubridate<span class="sc">::</span><span class="fu">parse_date_time2</span>(<span class="st">&quot;dmy&quot;</span>, <span class="at">cutoff_2000 =</span> cutoff_2000) <span class="sc">%&gt;%</span> </span>
<span id="cb10-12"><a href="snippets.html#cb10-12" aria-hidden="true" tabindex="-1"></a>    lubridate<span class="sc">::</span><span class="fu">as_date</span>() <span class="co"># Make Date object, rather than POSIXct</span></span>
<span id="cb10-13"><a href="snippets.html#cb10-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-14"><a href="snippets.html#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="snippets.html#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_dob</span>(chi)</span></code></pre></div>
<pre><code>## [1] &quot;1970-09-10&quot; &quot;1943-11-18&quot; &quot;1949-04-13&quot;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="snippets.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From tibble</span></span>
<span id="cb12-2"><a href="snippets.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">chi =</span> chi) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="snippets.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-4"><a href="snippets.html#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">dob =</span> <span class="fu">chi_dob</span>(chi)</span>
<span id="cb12-5"><a href="snippets.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   chi        dob       
##   &lt;chr&gt;      &lt;date&gt;    
## 1 1009701234 1970-09-10
## 2 1811431232 1943-11-18
## 3 1304496368 1949-04-13</code></pre>
</div>
<div id="chi_gender---extract-gender-from-chi" class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> <code>chi_gender()</code> - Extract gender from CHI</h3>
<p>Ninth digit is odd for men and even for women.
A test for even is <code>x modulus 2 == 0</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="snippets.html#cb14-1" aria-hidden="true" tabindex="-1"></a>chi_gender <span class="ot">=</span> <span class="cf">function</span>(.data){</span>
<span id="cb14-2"><a href="snippets.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  .data <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="snippets.html#cb14-3" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_sub</span>(<span class="dv">9</span>, <span class="dv">9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="snippets.html#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="snippets.html#cb14-5" aria-hidden="true" tabindex="-1"></a>    {<span class="fu">ifelse</span>(. <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>)}</span>
<span id="cb14-6"><a href="snippets.html#cb14-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-7"><a href="snippets.html#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="snippets.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_gender</span>(chi)</span></code></pre></div>
<pre><code>## [1] &quot;Male&quot;   &quot;Male&quot;   &quot;Female&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="snippets.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From tibble</span></span>
<span id="cb16-2"><a href="snippets.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">chi =</span> chi) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="snippets.html#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-4"><a href="snippets.html#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">dob =</span> <span class="fu">chi_dob</span>(chi),</span>
<span id="cb16-5"><a href="snippets.html#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">chi_gender</span>(chi)</span>
<span id="cb16-6"><a href="snippets.html#cb16-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   chi        dob        gender
##   &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt; 
## 1 1009701234 1970-09-10 Male  
## 2 1811431232 1943-11-18 Male  
## 3 1304496368 1949-04-13 Female</code></pre>
</div>
<div id="chi_age---extract-age-from-chi" class="section level3" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> <code>chi_age()</code> - Extract age from CHI</h3>
<p>Works for a single date or a vector of dates.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="snippets.html#cb18-1" aria-hidden="true" tabindex="-1"></a>chi_age <span class="ot">=</span> <span class="cf">function</span>(.data, ref_date, <span class="at">cutoff_2000 =</span> <span class="dv">20</span>){</span>
<span id="cb18-2"><a href="snippets.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  dob <span class="ot">=</span> <span class="fu">chi_dob</span>(.data, <span class="at">cutoff_2000 =</span> cutoff_2000)</span>
<span id="cb18-3"><a href="snippets.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  lubridate<span class="sc">::</span><span class="fu">interval</span>(dob, ref_date) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="snippets.html#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="st">&quot;years&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="snippets.html#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">floor</span>()</span>
<span id="cb18-6"><a href="snippets.html#cb18-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-7"><a href="snippets.html#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="snippets.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Today</span></span>
<span id="cb18-9"><a href="snippets.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_age</span>(chi, <span class="fu">Sys.time</span>())</span></code></pre></div>
<pre><code>## [1] 51 78 73</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="snippets.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Single date</span></span>
<span id="cb20-2"><a href="snippets.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb20-3"><a href="snippets.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_age</span>(chi, <span class="fu">dmy</span>(<span class="st">&quot;11/09/2018&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 48 74 69</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="snippets.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector</span></span>
<span id="cb22-2"><a href="snippets.html#cb22-2" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">=</span> <span class="fu">dmy</span>(<span class="st">&quot;11/09/2018&quot;</span>,</span>
<span id="cb22-3"><a href="snippets.html#cb22-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;09/05/2015&quot;</span>,</span>
<span id="cb22-4"><a href="snippets.html#cb22-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;10/03/2014&quot;</span>)</span>
<span id="cb22-5"><a href="snippets.html#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_age</span>(chi, dates)</span></code></pre></div>
<pre><code>## [1] 48 71 64</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="snippets.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From tibble</span></span>
<span id="cb24-2"><a href="snippets.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">chi =</span> chi) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="snippets.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-4"><a href="snippets.html#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">dob =</span> <span class="fu">chi_dob</span>(chi),</span>
<span id="cb24-5"><a href="snippets.html#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">chi_gender</span>(chi),</span>
<span id="cb24-6"><a href="snippets.html#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">chi_age</span>(chi, <span class="fu">Sys.time</span>())</span>
<span id="cb24-7"><a href="snippets.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##   chi        dob        gender   age
##   &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;
## 1 1009701234 1970-09-10 Male      51
## 2 1811431232 1943-11-18 Male      78
## 3 1304496368 1949-04-13 Female    73</code></pre>
</div>
<div id="chi_valid---logical-test-for-valid-chi" class="section level3" number="2.5.4">
<h3><span class="header-section-number">2.5.4</span> <code>chi_valid()</code> - Logical test for valid CHI</h3>
<p>The final digit of the CHI can be used to test that the number is correct via the modulus 11 algorithm.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="snippets.html#cb26-1" aria-hidden="true" tabindex="-1"></a>chi_valid <span class="ot">=</span> <span class="cf">function</span>(.data){</span>
<span id="cb26-2"><a href="snippets.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  .data <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="snippets.html#cb26-3" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_split</span>(<span class="st">&quot;&quot;</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="snippets.html#cb26-4" aria-hidden="true" tabindex="-1"></a>    .[, <span class="sc">-</span><span class="dv">10</span>] <span class="sc">%&gt;%</span>              <span class="co"># Working with matrices hence brackets</span></span>
<span id="cb26-5"><a href="snippets.html#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply</span>(<span class="dv">1</span>, as.numeric) <span class="sc">%&gt;%</span>  <span class="co"># Convert from string</span></span>
<span id="cb26-6"><a href="snippets.html#cb26-6" aria-hidden="true" tabindex="-1"></a>    {<span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">2</span>) <span class="sc">%*%</span> .} <span class="sc">%&gt;%</span>    <span class="co"># Multiply and sum step</span></span>
<span id="cb26-7"><a href="snippets.html#cb26-7" aria-hidden="true" tabindex="-1"></a>    {. <span class="sc">%%</span> <span class="dv">11</span>} <span class="sc">%&gt;%</span>             <span class="co"># Modulus 11</span></span>
<span id="cb26-8"><a href="snippets.html#cb26-8" aria-hidden="true" tabindex="-1"></a>    {<span class="dv">11</span> <span class="sc">-</span> .} <span class="sc">%&gt;%</span>              <span class="co"># Substract from 11</span></span>
<span id="cb26-9"><a href="snippets.html#cb26-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">near</span>(              <span class="co"># Compare result with 10th digit. </span></span>
<span id="cb26-10"><a href="snippets.html#cb26-10" aria-hidden="true" tabindex="-1"></a>      {stringr<span class="sc">::</span><span class="fu">str_sub</span>(chi, <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()}</span>
<span id="cb26-11"><a href="snippets.html#cb26-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb26-12"><a href="snippets.html#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.vector</span>()</span>
<span id="cb26-13"><a href="snippets.html#cb26-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-14"><a href="snippets.html#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="snippets.html#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_valid</span>(chi)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="snippets.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From tibble</span></span>
<span id="cb28-2"><a href="snippets.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">chi =</span> chi) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="snippets.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-4"><a href="snippets.html#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">dob =</span> <span class="fu">chi_dob</span>(chi),</span>
<span id="cb28-5"><a href="snippets.html#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">chi_gender</span>(chi),</span>
<span id="cb28-6"><a href="snippets.html#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">chi_age</span>(chi, <span class="fu">Sys.time</span>()),</span>
<span id="cb28-7"><a href="snippets.html#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">chi_valid =</span> <span class="fu">chi_valid</span>(chi)</span>
<span id="cb28-8"><a href="snippets.html#cb28-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   chi        dob        gender   age chi_valid
##   &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;lgl&gt;    
## 1 1009701234 1970-09-10 Male      51 FALSE    
## 2 1811431232 1943-11-18 Male      78 TRUE     
## 3 1304496368 1949-04-13 Female    73 TRUE</code></pre>
</div>
</div>
<div id="working-with-dates" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Working with dates</h2>
<div id="difference-between-two-dates" class="section level3" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Difference between two dates</h3>
<p>I always forget how to do this neatly.
I often want days as a numeric, not a lubridate type object.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="snippets.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb30-2"><a href="snippets.html#cb30-2" aria-hidden="true" tabindex="-1"></a>date1 <span class="ot">=</span> <span class="fu">dmy</span>(<span class="st">&quot;12/03/2018&quot;</span>, <span class="st">&quot;14/05/2017&quot;</span>)</span>
<span id="cb30-3"><a href="snippets.html#cb30-3" aria-hidden="true" tabindex="-1"></a>date2 <span class="ot">=</span> <span class="fu">dmy</span>(<span class="st">&quot;11/09/2019&quot;</span>, <span class="st">&quot;11/04/2019&quot;</span>)</span>
<span id="cb30-4"><a href="snippets.html#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="snippets.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">interval</span>(date1, date2) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="snippets.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="st">&quot;days&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 548 697</code></pre>
</div>
<div id="lags" class="section level3" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> Lags</h3>
<p>This is useful for calculating, for instance, the period off medications. Lags are much better than long to wide solutions for this.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="snippets.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb32-2"><a href="snippets.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb32-3"><a href="snippets.html#cb32-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>) </span>
<span id="cb32-4"><a href="snippets.html#cb32-4" aria-hidden="true" tabindex="-1"></a>medication <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;aspirin&quot;</span>, <span class="st">&quot;aspirin&quot;</span>, <span class="st">&quot;aspirin&quot;</span>, <span class="st">&quot;tylenol&quot;</span>, <span class="st">&quot;lipitor&quot;</span>, <span class="st">&quot;advil&quot;</span>) </span>
<span id="cb32-5"><a href="snippets.html#cb32-5" aria-hidden="true" tabindex="-1"></a>start.date <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;05/01/2017&quot;</span>, <span class="st">&quot;05/30/2017&quot;</span>, <span class="st">&quot;07/15/2017&quot;</span>, <span class="st">&quot;05/01/2017&quot;</span>, <span class="st">&quot;05/06/2017&quot;</span>, <span class="st">&quot;05/28/2017&quot;</span>)</span>
<span id="cb32-6"><a href="snippets.html#cb32-6" aria-hidden="true" tabindex="-1"></a>stop.date <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;05/04/2017&quot;</span>, <span class="st">&quot;06/10/2017&quot;</span>, <span class="st">&quot;07/27/2017&quot;</span>, <span class="st">&quot;05/15/2017&quot;</span>, <span class="st">&quot;05/12/2017&quot;</span>, <span class="st">&quot;06/13/2017&quot;</span>)</span>
<span id="cb32-7"><a href="snippets.html#cb32-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">tibble</span>(id, medication, start.date, stop.date)</span>
<span id="cb32-8"><a href="snippets.html#cb32-8" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##      id medication start.date stop.date 
##   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
## 1     2 aspirin    05/01/2017 05/04/2017
## 2     2 aspirin    05/30/2017 06/10/2017
## 3     2 aspirin    07/15/2017 07/27/2017
## 4     2 tylenol    05/01/2017 05/15/2017
## 5     3 lipitor    05/06/2017 05/12/2017
## 6     5 advil      05/28/2017 06/13/2017</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="snippets.html#cb34-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="snippets.html#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&quot;start.date&quot;</span>, <span class="st">&quot;stop.date&quot;</span>), lubridate<span class="sc">::</span>mdy) <span class="sc">%&gt;%</span> <span class="co"># make a date</span></span>
<span id="cb34-3"><a href="snippets.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, medication, start.date) <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="snippets.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id, medication) <span class="sc">%&gt;%</span> </span>
<span id="cb34-5"><a href="snippets.html#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-6"><a href="snippets.html#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_date_diff =</span> start.date <span class="sc">-</span> <span class="fu">lag</span>(start.date),</span>
<span id="cb34-7"><a href="snippets.html#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">medication_period =</span> stop.date<span class="sc">-</span>start.date</span>
<span id="cb34-8"><a href="snippets.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
## # Groups:   id, medication [4]
##      id medication start.date stop.date  start_date_diff medication_period
##   &lt;dbl&gt; &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;     &lt;drtn&gt;          &lt;drtn&gt;           
## 1     2 aspirin    2017-05-01 2017-05-04 NA days          3 days          
## 2     2 aspirin    2017-05-30 2017-06-10 29 days         11 days          
## 3     2 aspirin    2017-07-15 2017-07-27 46 days         12 days          
## 4     2 tylenol    2017-05-01 2017-05-15 NA days         14 days          
## 5     3 lipitor    2017-05-06 2017-05-12 NA days          6 days          
## 6     5 advil      2017-05-28 2017-06-13 NA days         16 days</code></pre>
</div>
<div id="pulling-out-change-in-status-data" class="section level3" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> Pulling out “change in status” data</h3>
<p>If you have a number of episodes per patient, each with a status and a time, then you need to do this as a starting point for CPH analysis.</p>
</div>
<div id="guess-the-format-of-dates" class="section level3" number="2.6.4">
<h3><span class="header-section-number">2.6.4</span> Guess the Format of Dates</h3>
<p>This function helps guess the date format from a dataset you have received. Add in new formats (as per lubridate) if they don’t match. Once you work out what format it is then extract date with <code>mdy()</code> or <code>dmy()</code> etc. based on format.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="snippets.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb36-2"><a href="snippets.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb36-3"><a href="snippets.html#cb36-3" aria-hidden="true" tabindex="-1"></a>lakers <span class="ot">=</span> lakers <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="snippets.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_date =</span> <span class="fu">paste0</span>(<span class="fu">str_sub</span>(date, <span class="at">start =</span><span class="dv">5</span>, <span class="at">end =</span> <span class="dv">6</span>), <span class="st">&quot;/&quot;</span>,</span>
<span id="cb36-5"><a href="snippets.html#cb36-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_sub</span>(date, <span class="at">start =</span> <span class="dv">7</span>, <span class="at">end =</span> <span class="dv">8</span>), <span class="st">&quot;/&quot;</span>,</span>
<span id="cb36-6"><a href="snippets.html#cb36-6" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_sub</span>(date, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">4</span>)),</span>
<span id="cb36-7"><a href="snippets.html#cb36-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">dd_date =</span> <span class="fu">paste0</span>(<span class="fu">str_sub</span>(date, <span class="at">start =</span><span class="dv">7</span>, <span class="at">end =</span> <span class="dv">8</span>), <span class="st">&quot;/&quot;</span>,</span>
<span id="cb36-8"><a href="snippets.html#cb36-8" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_sub</span>(date, <span class="at">start =</span> <span class="dv">5</span>, <span class="at">end =</span> <span class="dv">6</span>), <span class="st">&quot;/&quot;</span>,</span>
<span id="cb36-9"><a href="snippets.html#cb36-9" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_sub</span>(date, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">4</span>)))</span>
<span id="cb36-10"><a href="snippets.html#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="snippets.html#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="fu">guess_formats</span>(lakers<span class="sc">$</span>mm_date, <span class="fu">c</span>(<span class="st">&quot;dmy&quot;</span>, <span class="st">&quot;mdy&quot;</span>), <span class="at">print_matches =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-12"><a href="snippets.html#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="fu">guess_formats</span>(lakers<span class="sc">$</span>dd_date, <span class="fu">c</span>(<span class="st">&quot;dmy&quot;</span>, <span class="st">&quot;mdy&quot;</span>), <span class="at">print_matches =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div id="example-data" class="section level4" number="2.6.4.1">
<h4><span class="header-section-number">2.6.4.1</span> Example data</h4>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="snippets.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb37-2"><a href="snippets.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb37-3"><a href="snippets.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(finalfit)</span>
<span id="cb37-4"><a href="snippets.html#cb37-4" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">=</span> <span class="fu">tibble</span>(</span>
<span id="cb37-5"><a href="snippets.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>),</span>
<span id="cb37-6"><a href="snippets.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">status =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb37-7"><a href="snippets.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">8</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">12</span>)) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb37-8"><a href="snippets.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">opdate =</span> <span class="fu">rep</span>(<span class="st">&quot;2010/01/01&quot;</span>, <span class="dv">20</span>) <span class="sc">%&gt;%</span> <span class="fu">ymd</span>(),</span>
<span id="cb37-9"><a href="snippets.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">status_date =</span> <span class="fu">c</span>(</span>
<span id="cb37-10"><a href="snippets.html#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2010/02/01&quot;</span>, <span class="st">&quot;2010/03/01&quot;</span>, <span class="st">&quot;2010/04/01&quot;</span>, <span class="st">&quot;2010/05/01&quot;</span>,</span>
<span id="cb37-11"><a href="snippets.html#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2010/02/02&quot;</span>, <span class="st">&quot;2010/03/02&quot;</span>, <span class="st">&quot;2010/04/02&quot;</span>, <span class="st">&quot;2010/05/02&quot;</span>,</span>
<span id="cb37-12"><a href="snippets.html#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2010/02/03&quot;</span>, <span class="st">&quot;2010/03/03&quot;</span>, <span class="st">&quot;2010/04/03&quot;</span>, <span class="st">&quot;2010/05/03&quot;</span>,</span>
<span id="cb37-13"><a href="snippets.html#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2010/02/04&quot;</span>, <span class="st">&quot;2010/03/04&quot;</span>, <span class="st">&quot;2010/04/04&quot;</span>, <span class="st">&quot;2010/05/04&quot;</span>,</span>
<span id="cb37-14"><a href="snippets.html#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2010/02/05&quot;</span>, <span class="st">&quot;2010/03/05&quot;</span>, <span class="st">&quot;2010/04/05&quot;</span>, <span class="st">&quot;2010/05/05&quot;</span></span>
<span id="cb37-15"><a href="snippets.html#cb37-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ymd</span>()</span>
<span id="cb37-16"><a href="snippets.html#cb37-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-17"><a href="snippets.html#cb37-17" aria-hidden="true" tabindex="-1"></a>mydata</span></code></pre></div>
<pre><code>## # A tibble: 20 × 5
##       id status group opdate     status_date
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt; &lt;date&gt;     &lt;date&gt;     
##  1     1      0 0     2010-01-01 2010-02-01 
##  2     1      0 0     2010-01-01 2010-03-01 
##  3     1      0 0     2010-01-01 2010-04-01 
##  4     1      1 0     2010-01-01 2010-05-01 
##  5     2      0 0     2010-01-01 2010-02-02 
##  6     2      0 0     2010-01-01 2010-03-02 
##  7     2      1 0     2010-01-01 2010-04-02 
##  8     2      1 0     2010-01-01 2010-05-02 
##  9     3      0 1     2010-01-01 2010-02-03 
## 10     3      0 1     2010-01-01 2010-03-03 
## 11     3      0 1     2010-01-01 2010-04-03 
## 12     3      0 1     2010-01-01 2010-05-03 
## 13     4      0 1     2010-01-01 2010-02-04 
## 14     4      1 1     2010-01-01 2010-03-04 
## 15     4      1 1     2010-01-01 2010-04-04 
## 16     4      1 1     2010-01-01 2010-05-04 
## 17     5      0 1     2010-01-01 2010-02-05 
## 18     5      0 1     2010-01-01 2010-03-05 
## 19     5      1 1     2010-01-01 2010-04-05 
## 20     5      1 1     2010-01-01 2010-05-05</code></pre>
</div>
<div id="compute-time-from-op-date-to-current-review" class="section level4" number="2.6.4.2">
<h4><span class="header-section-number">2.6.4.2</span> Compute time from op date to current review</h4>
<p>… if necessary</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="snippets.html#cb39-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">=</span> mydata <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="snippets.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, status_date) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="snippets.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-4"><a href="snippets.html#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">interval</span>(opdate, status_date) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(<span class="st">&quot;days&quot;</span>)</span>
<span id="cb39-5"><a href="snippets.html#cb39-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-6"><a href="snippets.html#cb39-6" aria-hidden="true" tabindex="-1"></a>mydata</span></code></pre></div>
<pre><code>## # A tibble: 20 × 6
##       id status group opdate     status_date  time
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt; &lt;date&gt;     &lt;date&gt;      &lt;dbl&gt;
##  1     1      0 0     2010-01-01 2010-02-01     31
##  2     1      0 0     2010-01-01 2010-03-01     59
##  3     1      0 0     2010-01-01 2010-04-01     90
##  4     1      1 0     2010-01-01 2010-05-01    120
##  5     2      0 0     2010-01-01 2010-02-02     32
##  6     2      0 0     2010-01-01 2010-03-02     60
##  7     2      1 0     2010-01-01 2010-04-02     91
##  8     2      1 0     2010-01-01 2010-05-02    121
##  9     3      0 1     2010-01-01 2010-02-03     33
## 10     3      0 1     2010-01-01 2010-03-03     61
## 11     3      0 1     2010-01-01 2010-04-03     92
## 12     3      0 1     2010-01-01 2010-05-03    122
## 13     4      0 1     2010-01-01 2010-02-04     34
## 14     4      1 1     2010-01-01 2010-03-04     62
## 15     4      1 1     2010-01-01 2010-04-04     93
## 16     4      1 1     2010-01-01 2010-05-04    123
## 17     5      0 1     2010-01-01 2010-02-05     35
## 18     5      0 1     2010-01-01 2010-03-05     63
## 19     5      1 1     2010-01-01 2010-04-05     94
## 20     5      1 1     2010-01-01 2010-05-05    124</code></pre>
</div>
<div id="pull-out-change-of-status" class="section level4" number="2.6.4.3">
<h4><span class="header-section-number">2.6.4.3</span> Pull out “change of status”</h4>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="snippets.html#cb41-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">=</span> mydata <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="snippets.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="snippets.html#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-4"><a href="snippets.html#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">status_change =</span> status <span class="sc">-</span> <span class="fu">lag</span>(status) <span class="sc">==</span> <span class="dv">1</span>,                          <span class="co"># Mark TRUE if goes from 0 to 1</span></span>
<span id="cb41-5"><a href="snippets.html#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">status_nochange =</span> <span class="fu">sum</span>(status) <span class="sc">==</span> <span class="dv">0</span>,                                 <span class="co"># Mark if no change from 0</span></span>
<span id="cb41-6"><a href="snippets.html#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">status_nochange_keep =</span> <span class="sc">!</span><span class="fu">duplicated</span>(status_nochange, <span class="at">fromLast=</span> <span class="cn">TRUE</span>) <span class="co"># Mark most recent &quot;no change&quot; episode</span></span>
<span id="cb41-7"><a href="snippets.html#cb41-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb41-8"><a href="snippets.html#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status_change <span class="sc">|</span> (status_nochange <span class="sc">&amp;</span> status_nochange_keep)) <span class="sc">%&gt;%</span>  <span class="co"># Filter out other episodes</span></span>
<span id="cb41-9"><a href="snippets.html#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(status_change, status_nochange, status_nochange_keep))      <span class="co"># Remove columns not needed</span></span>
<span id="cb41-10"><a href="snippets.html#cb41-10" aria-hidden="true" tabindex="-1"></a>mydata</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
## # Groups:   id [5]
##      id status group opdate     status_date  time
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt; &lt;date&gt;     &lt;date&gt;      &lt;dbl&gt;
## 1     1      1 0     2010-01-01 2010-05-01    120
## 2     2      1 0     2010-01-01 2010-04-02     91
## 3     3      0 1     2010-01-01 2010-05-03    122
## 4     4      1 1     2010-01-01 2010-03-04     62
## 5     5      1 1     2010-01-01 2010-04-05     94</code></pre>
</div>
<div id="run-cph" class="section level4" number="2.6.4.4">
<h4><span class="header-section-number">2.6.4.4</span> Run CPH</h4>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="snippets.html#cb43-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="snippets.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalfit</span>(<span class="st">&quot;Surv(time, status)&quot;</span>, <span class="st">&quot;group&quot;</span>)</span></code></pre></div>
<pre><code>##  Dependent: Surv(time, status)         all          HR (univariable)
##                          group 0 2 (100.0)                         -
##                                1 3 (100.0) 0.76 (0.10-5.51, p=0.786)
##         HR (multivariable)
##                          -
##  0.76 (0.10-5.51, p=0.786)</code></pre>
</div>
</div>
<div id="isoweek-and-epiweek" class="section level3" number="2.6.5">
<h3><span class="header-section-number">2.6.5</span> Isoweek and epiweek</h3>
<p>This is frequently painful, when working with weeks in a year to aggregate data, how to best plot and how to deal with multiple years.</p>
<p>Easiest solution I have found (EMH) is just to work with the first date of each isoweek. Make a look up table and join.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="snippets.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random set of dates for demonstration purposes</span></span>
<span id="cb45-2"><a href="snippets.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="do">## This is not required when using normally</span></span>
<span id="cb45-3"><a href="snippets.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb45-4"><a href="snippets.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb45-5"><a href="snippets.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(finalfit)</span>
<span id="cb45-6"><a href="snippets.html#cb45-6" aria-hidden="true" tabindex="-1"></a>colon_s <span class="ot">=</span> colon_s <span class="sc">%&gt;%</span> </span>
<span id="cb45-7"><a href="snippets.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-8"><a href="snippets.html#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="dv">20200101</span>), <span class="fu">ymd</span>(<span class="dv">20220601</span>), <span class="at">by=</span><span class="st">&quot;day&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-9"><a href="snippets.html#cb45-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sample</span>(<span class="dv">929</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-10"><a href="snippets.html#cb45-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-11"><a href="snippets.html#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="snippets.html#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Make isoweek start date look-up table</span></span>
<span id="cb45-13"><a href="snippets.html#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Make sure includes entire range of your dates of interest. </span></span>
<span id="cb45-14"><a href="snippets.html#cb45-14" aria-hidden="true" tabindex="-1"></a>isoweek_lookup <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="dv">20200101</span>), <span class="fu">ymd</span>(<span class="dv">20220601</span>), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-15"><a href="snippets.html#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">isoweek =</span> lubridate<span class="sc">::</span><span class="fu">isoweek</span>(date),</span>
<span id="cb45-16"><a href="snippets.html#cb45-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(date))</span>
<span id="cb45-17"><a href="snippets.html#cb45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-18"><a href="snippets.html#cb45-18" aria-hidden="true" tabindex="-1"></a>isoweek_lookup <span class="ot">=</span> isoweek_lookup <span class="sc">%&gt;%</span> </span>
<span id="cb45-19"><a href="snippets.html#cb45-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(isoweek_lookup <span class="sc">%&gt;%</span> </span>
<span id="cb45-20"><a href="snippets.html#cb45-20" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(isoweek, year) <span class="sc">%&gt;%</span> </span>
<span id="cb45-21"><a href="snippets.html#cb45-21" aria-hidden="true" tabindex="-1"></a>              <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-22"><a href="snippets.html#cb45-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(<span class="at">isoweek_date =</span> date, isoweek, year)</span>
<span id="cb45-23"><a href="snippets.html#cb45-23" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;isoweek&quot;, &quot;year&quot;)</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="snippets.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add isoweek_date (first date of a particular isoweek) and isoweek to analysis dataset. </span></span>
<span id="cb47-2"><a href="snippets.html#cb47-2" aria-hidden="true" tabindex="-1"></a>colon_s <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="snippets.html#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(isoweek_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span> <span class="ot">=</span> <span class="st">&quot;date&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a href="snippets.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, isoweek, isoweek_date) <span class="sc">%&gt;%</span> </span>
<span id="cb47-5"><a href="snippets.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span></code></pre></div>
<pre><code>##         date isoweek isoweek_date
## 1 2020-11-07      45   2020-11-02
## 2 2022-02-04       5   2022-01-31
## 3 2020-11-11      46   2020-11-09
## 4 2020-08-15      33   2020-08-10
## 5 2021-12-26      51   2021-12-20
## 6 2020-11-23      48   2020-11-23</code></pre>
</div>
</div>
<div id="labelling-tables-and-figures-in-markdown-chunks" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Labelling tables and figures in markdown chunks</h2>
<div id="plots" class="section level3" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Plots</h3>
<p>I have made a plot and it looks nice (See Figure <code>\ref{fig:a-nice-plot}</code>)</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb49-1"><a href="snippets.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.cap=&quot;A nice plot.\\label{fig:a-nice-plot}}</span></span>
<span id="cb49-2"><a href="snippets.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(mydata, aes(x = x)) +</span></span>
<span id="cb49-3"><a href="snippets.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram()</span></span>
<span id="cb49-4"><a href="snippets.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
</div>
<div id="tables" class="section level3" number="2.7.2">
<h3><span class="header-section-number">2.7.2</span> Tables</h3>
<p>I have made a table and it looks nice (See Table <code>\ref{tab:a-nice-table}</code>)</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb50-1"><a href="snippets.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-2"><a href="snippets.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb50-3"><a href="snippets.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="in">kable(mtcars[1:3,1:4], caption=&quot;A nice table.\\label{tab:a-nice-table}&quot;)</span></span>
<span id="cb50-4"><a href="snippets.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-manipulation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["cookbook.pdf", "cookbook.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
